
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the news application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "lastActive": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the user's last activity."
        },
        "lastNotificationSentAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the last push notification was sent to the user."
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a chat message within news.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "senderId": {
          "type": "string",
          "description": "The username of the User who sent the message."
        },
        "recipientId": {
          "type": "string",
          "description": "The username of the User who is the recipient of the message."
        },
        "senderUid": {
          "type": "string",
          "description": "The UID of the User who sent the message. (Relationship: User 1:N ChatMessage)"
        },
        "recipientUid": {
          "type": "string",
          "description": "The UID of the User who is the recipient of the message. (Relationship: User 1:N ChatMessage)"
        },
        "originalMessage": {
          "type": "string",
          "description": "The original, un-scrambled message text."
        },
        "scrambledMessage": {
          "type": "string",
          "description": "The scrambled version of the message."
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time when the message was sent.",
          "format": "date-time"
        },
        "scrambleMethod": {
          "type": "string",
          "description": "The scrambling method used for this message (e.g., letter substitution, reverse)."
        },
        "isFavorited": {
          "type": "boolean",
          "description": "Indicates if the message has been marked as a favorite by a user."
        }
      },
      "required": [
        "id",
        "senderId",
        "recipientId",
        "senderUid",
        "recipientUid",
        "originalMessage",
        "scrambledMessage",
        "timestamp",
        "scrambleMethod"
      ]
    },
    "FCMToken": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FCMToken",
      "type": "object",
      "description": "Stores a Firebase Cloud Messaging (FCM) token for a user to enable push notifications.",
      "properties": {
        "token": {
          "type": "string",
          "description": "The FCM registration token."
        },
        "username": {
          "type": "string",
          "description": "The username of the user this token belongs to."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the token was created or last updated."
        }
      },
      "required": [
        "token",
        "username",
        "createdAt"
      ]
    },
    "BucketListItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BucketListItem",
      "type": "object",
      "description": "Represents an item in the shared bucket list.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the bucket list item."
        },
        "text": {
          "type": "string",
          "description": "The content of the bucket list item."
        },
        "authorUsername": {
          "type": "string",
          "description": "The username of the user who added the item."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the item was created."
        },
        "isDone": {
          "type": "boolean",
          "description": "Indicates if the bucket list item is completed.",
          "default": false
        },
        "priority": {
          "type": "string",
          "description": "The priority of the bucket list item.",
          "enum": ["low", "medium", "high"],
          "default": "medium"
        }
      },
      "required": [
        "id",
        "text",
        "authorUsername",
        "createdAt"
      ]
    },
    "LetterEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LetterEntry",
      "type": "object",
      "description": "Represents a paragraph entry in the shared letter.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the letter entry."
        },
        "text": {
          "type": "string",
          "description": "The content of the letter entry."
        },
        "authorUsername": {
          "type": "string",
          "description": "The username of the user who added the entry."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the entry was created."
        }
      },
      "required": [
        "id",
        "text",
        "authorUsername",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Data is public.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ],
          "operations": {
            "update": {
              "rule": "request.auth.uid == userId",
              "description": "A user can only update their own profile."
            }
          }
        }
      },
      {
        "path": "/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores all chat messages. Data is public.",
          "params": [
            {
              "name": "messageId",
              "description": "The unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "/fcmTokens/{tokenId}",
        "definition": {
          "entityName": "FCMToken",
          "schema": {
            "$ref": "#/backend/entities/FCMToken"
          },
          "description": "Stores FCM tokens for push notifications. Data is public.",
          "params": [
            {
              "name": "tokenId",
              "description": "The unique identifier for the token document."
            }
          ],
          "queries": [
            {
              "description": "Finds the latest FCM token for a given username.",
              "collection": "fcmTokens",
              "clauses": [
                {
                  "field": "username",
                  "operator": "==",
                  "value": "string"
                },
                {
                  "field": "createdAt",
                  "operator": "desc",
                  "value": null
                }
              ]
            }
          ]
        }
      },
      {
        "path": "/bucketList/{itemId}",
        "definition": {
          "entityName": "BucketListItem",
          "schema": {
            "$ref": "#/backend/entities/BucketListItem"
          },
          "description": "Stores shared bucket list items. Data is public.",
          "params": [
            {
              "name": "itemId",
              "description": "The unique identifier for the bucket list item."
            }
          ],
          "queries": [
             {
              "description": "Fetches all bucket list items, ordered by completion status, priority, and creation date.",
              "collection": "bucketList",
              "clauses": [
                {
                  "field": "isDone",
                  "operator": "asc",
                  "value": null
                },
                {
                  "field": "priority",
                  "operator": "desc",
                  "value": null
                },
                {
                  "field": "createdAt",
                  "operator": "desc",
                  "value": null
                }
              ]
            }
          ]
        }
      },
      {
        "path": "/letter/{entryId}",
        "definition": {
          "entityName": "LetterEntry",
          "schema": {
            "$ref": "#/backend/entities/LetterEntry"
          },
          "description": "Stores shared letter entries. Data is public.",
          "params": [
            {
              "name": "entryId",
              "description": "The unique identifier for the letter entry."
            }
          ],
          "queries": [
            {
              "description": "Fetches all letter entries, ordered by creation date.",
              "collection": "letter",
              "clauses": [
                {
                  "field": "createdAt",
                  "operator": "asc",
                  "value": null
                }
              ]
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is simplified for a two-user prototype where strict security is not a requirement. All data in the 'users', 'messages', 'fcmTokens', 'bucketList', and 'letter' collections are public to allow for easy reading and writing without complex authentication checks. This model is suitable for rapid prototyping but should be secured before moving to a production environment with more users."
  }
}

    