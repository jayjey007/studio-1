
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CipherChat application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "lastActive": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp of the user's last activity."
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a chat message within CipherChat.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "senderId": {
          "type": "string",
          "description": "The username of the User who sent the message."
        },
        "recipientId": {
          "type": "string",
          "description": "The username of the User who is the recipient of the message."
        },
        "senderUid": {
          "type": "string",
          "description": "The UID of the User who sent the message. (Relationship: User 1:N ChatMessage)"
        },
        "recipientUid": {
          "type": "string",
          "description": "The UID of the User who is the recipient of the message. (Relationship: User 1:N ChatMessage)"
        },
        "originalMessage": {
          "type": "string",
          "description": "The original, un-scrambled message text."
        },
        "scrambledMessage": {
          "type": "string",
          "description": "The scrambled version of the message."
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time when the message was sent.",
          "format": "date-time"
        },
        "scrambleMethod": {
          "type": "string",
          "description": "The scrambling method used for this message (e.g., letter substitution, reverse)."
        }
      },
      "required": [
        "id",
        "senderId",
        "recipientId",
        "senderUid",
        "recipientUid",
        "originalMessage",
        "scrambledMessage",
        "timestamp",
        "scrambleMethod"
      ]
    },
    "FCMToken": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FCMToken",
      "type": "object",
      "description": "Stores a Firebase Cloud Messaging (FCM) token for a user to enable push notifications.",
      "properties": {
        "token": {
          "type": "string",
          "description": "The FCM registration token."
        },
        "username": {
          "type": "string",
          "description": "The username of the user this token belongs to."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the token was created or last updated."
        }
      },
      "required": ["token", "username", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Data is public.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores all chat messages. Data is public.",
          "params": [
            {
              "name": "messageId",
              "description": "The unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "/fcmTokens/{tokenId}",
        "definition": {
          "entityName": "FCMToken",
          "schema": {
            "$ref": "#/backend/entities/FCMToken"
          },
          "description": "Stores FCM tokens for push notifications. Data is public.",
          "params": [
            {
              "name": "tokenId",
              "description": "The unique identifier for the token document."
            }
          ],
          "queries": [
            {
              "description": "Finds the latest FCM token for a given username.",
              "collection": "fcmTokens",
              "clauses": [
                {
                  "field": "username",
                  "operator": "==",
                  "value": "string"
                },
                {
                  "field": "createdAt",
                  "operator": "desc",
                  "value": null
                }
              ]
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is simplified for a two-user prototype where strict security is not a requirement. All data in the 'users', 'messages', and 'fcmTokens' collections are public to allow for easy reading and writing without complex authentication checks. This model is suitable for rapid prototyping but should be secured before moving to a production environment with more users."
  }
}

    